#include "Stdafx.h"
#include "Core/Core.h"
#include "Math/CoordinateSystemManager.h"
#include "Math/WKTReader.h"
#include "Math/Geometry/Polygon.h"
#include "Text/CString.h"

#include <stdio.h>

Int32 MyMain(Core::IProgControl *progCtrl)
{
	Text::CString pgWKT = CSTR("POLYGON((114.2211697 22.3623449,114.22117208 22.36235006,114.22118051 22.3623859,114.22118256 22.36239487,114.22118383 22.36240551,114.22118442 22.36241466,114.22118421 22.362433,114.22118284 22.3624467,114.22116685 22.36249372,114.22116202 22.36250618,114.22115754 22.36251929,114.22115246 22.36253701,114.22114932 22.36255046,114.22114752 22.36256155,114.2211451 22.36258437,114.22114387 22.36260268,114.22114281 22.3626312,114.22114036 22.36264475,114.22113587 22.36265785,114.22113092 22.36266842,114.22112859 22.36267246,114.22112316 22.36268011,114.22111676 22.36268709,114.22111323 22.36269029,114.22110819 22.36269662,114.22110356 22.3627047,114.22110037 22.36271337,114.22109934 22.36271786,114.2210987 22.36272241,114.22109854 22.36273084,114.22110014 22.36273988,114.22110162 22.36274425,114.22110586 22.36275252,114.22111551 22.36276583,114.22112167 22.362773,114.22112835 22.36277974,114.22113552 22.36278604,114.22114315 22.36279185,114.22119891 22.36282551,114.22120661 22.36283328,114.22120957 22.36283695,114.22121473 22.36284476,114.22121884 22.36285309,114.22122181 22.36286183,114.22122589 22.36287776,114.22122825 22.36289134,114.2212291 22.36290048,114.22122939 22.36290964,114.22122934 22.36295665,114.22122815 22.36301123,114.22122645 22.36304953,114.22122492 22.3630707,114.2212245 22.36308445,114.22122479 22.36310738,114.22122676 22.36313483,114.22122643 22.3631406,114.22122672 22.36314518,114.22122873 22.36315414,114.22123259 22.36316256,114.22123517 22.36316647,114.22124144 22.36317425,114.22125122 22.36318457,114.22125581 22.36319017,114.22126098 22.36319797,114.2212632 22.36320207,114.22126688 22.36321057,114.22126949 22.36321941,114.22127096 22.36322938,114.22127165 22.36323853,114.22127172 22.3632477,114.22127118 22.36325685,114.22126488 22.36330953,114.22125967 22.36334074,114.22125233 22.36337896,114.22125179 22.36338352,114.22125192 22.36339268,114.22125258 22.36339722,114.22125662 22.36341288,114.22126121 22.36342595,114.22126774 22.36343828,114.22127312 22.36344597,114.2212806 22.36345914,114.22129032 22.3634751,114.22130596 22.36349845,114.22134818 22.36356446,114.22135906 22.36357883,114.22136797 22.36358982,114.22138038 22.36360408,114.22139006 22.36361448,114.22140347 22.36362793,114.2214177 22.36364093,114.22143251 22.36365303,114.22144802 22.36366437,114.22146933 22.36367797,114.22149071 22.36368938,114.22151301 22.36369915,114.22152216 22.36370259,114.2215313 22.36370469,114.22153583 22.3637065,114.22154011 22.36370877,114.22154409 22.36371148,114.22154772 22.36371458,114.22155095 22.36371804,114.22155915 22.3637297,114.22156392 22.36373772,114.22157004 22.36375024,114.22157884 22.36377733,114.2215866 22.36380389,114.22159489 22.36384341,114.22160466 22.36388367,114.2216083 22.3639031,114.22161306 22.3639256,114.22161838 22.36394799,114.22162184 22.36396028,114.22162348 22.36396461,114.22162745 22.363973,114.22164132 22.36399505,114.22164705 22.36400251,114.22165352 22.36400943,114.22166065 22.36401576,114.22167233 22.3640242,114.221685 22.3640313,114.22169393 22.36403519,114.22170789 22.3640397,114.22171749 22.3640418,114.22173447 22.3640429,114.22174914 22.36404472,114.22176846 22.36404841,114.22178579 22.36405316,114.22179537 22.36405535,114.22180506 22.36405709,114.22181216 22.36405783,114.22181709 22.36405785,114.22182686 22.36405668,114.22183163 22.36405551,114.22184073 22.36405201,114.22184501 22.36404972,114.22184884 22.36404677,114.22185585 22.36404033,114.22185904 22.36403683,114.22186473 22.36402935,114.22186944 22.36402129,114.22189968 22.36395175,114.22190731 22.36392737,114.22191356 22.36390519,114.22191921 22.36388287,114.22192799 22.36384473,114.22193692 22.36381372,114.22195343 22.36376468,114.22196174 22.36374309,114.22196906 22.36372605,114.22197956 22.36369763,114.22199023 22.3636671,114.22199291 22.36365671,114.22199545 22.36364316,114.22199694 22.36362948,114.22199734 22.36362031,114.22199417 22.36359676,114.22199162 22.36358321,114.22198857 22.36356975,114.22198744 22.36356529,114.22198658 22.36355499,114.22198428 22.3635414,114.22198068 22.36352806,114.22197581 22.36351508,114.22197348 22.36350671,114.22197291 22.36350216,114.22197281 22.36349757,114.221974 22.36348848,114.22197528 22.36348405,114.22198161 22.3634689,114.22198289 22.36346447,114.22198453 22.36345543,114.22198509 22.36344613,114.22198473 22.36343697,114.22198338 22.36342789,114.22198103 22.36341898,114.22197773 22.36341034,114.2219713 22.36339826,114.22196624 22.36339038,114.2219607 22.36338279,114.22195153 22.36337201,114.22194873 22.36336752,114.22194512 22.363359,114.22194332 22.36334999,114.22194302 22.36333082,114.22194245 22.36332166,114.22193903 22.36329298,114.22193741 22.36328394,114.2219352 22.363275,114.22193077 22.36326188,114.221929 22.3632576,114.22192145 22.36324321,114.22189689 22.36319823,114.22186874 22.36314575,114.22186301 22.36313428,114.22185964 22.36312566,114.22185693 22.36311684,114.22185416 22.36310333,114.22183857 22.36303708,114.2218329 22.36302028,114.22182648 22.36300293,114.22181956 22.36298576,114.22181213 22.36296876,114.22179544 22.3629375,114.22177854 22.36290436,114.22176927 22.36288749,114.22175927 22.36286654,114.22175582 22.36284674,114.22175407 22.36282847,114.22175042 22.36280938,114.22174466 22.36278239,114.22174008 22.36276941,114.22173703 22.36275595,114.22173557 22.36274227,114.22173508 22.36272169,114.22173583 22.36270795,114.22173793 22.36269434,114.22174045 22.36268723,114.2217441 22.36267872,114.22174836 22.36267044,114.2217532 22.36266245,114.22175555 22.36265675,114.22175811 22.3626479,114.22175946 22.36263882,114.22175959 22.36262965,114.22175291 22.36259916,114.22175046 22.3625943,114.22174889 22.36258996,114.22174782 22.36258548,114.22174726 22.36258093,114.22174722 22.36257634,114.2217477 22.36257178,114.22175114 22.36255575,114.22175294 22.36254017,114.22175287 22.36252642,114.22175186 22.3625173,114.22175354 22.3625032,114.22175677 22.36248978,114.22176162 22.36247969,114.2217646 22.36247095,114.22176573 22.36246648,114.2217694 22.36244266,114.22177022 22.36243352,114.22177007 22.36241977,114.22176777 22.36239675,114.22176519 22.36237857,114.2217626 22.36236502,114.22176248 22.36235114,114.22176329 22.36233741,114.22176503 22.36232375,114.22177774 22.36226396,114.22178461 22.36222783,114.22179015 22.36219476,114.22179117 22.36218563,114.22179168 22.36217647,114.22179153 22.36216272,114.22179002 22.36214504,114.22178847 22.36213598,114.2217862 22.36212706,114.22178322 22.36211832,114.22177954 22.36210981,114.22177312 22.36209768,114.22176568 22.3620858,114.22175432 22.36207081,114.22174159 22.36205682,114.22173084 22.36204737,114.22172305 22.36204175,114.22171482 22.3620367,114.22169681 22.36202753,114.22168331 22.3620219,114.22167409 22.36201863,114.22165221 22.36201231,114.22164267 22.36200997,114.22163304 22.36200799,114.22161845 22.3620057,114.22156242 22.36199946,114.22152309 22.36199649,114.22150234 22.36199605,114.22148261 22.36199621,114.22140931 22.36199886,114.22137488 22.36200121,114.22134079 22.36200654,114.22132149 22.36201032,114.22130238 22.36201467,114.2212835 22.36202001,114.22126958 22.36202469,114.22125692 22.36203084,114.22124842 22.3620355,114.22123609 22.3620431,114.22122817 22.36204857,114.22121934 22.36205708,114.2212099 22.36206767,114.22120413 22.3620751,114.2211988 22.36208282,114.22118628 22.36210434,114.22117612 22.36212522,114.22117077 22.36213805,114.22116846 22.36214503,114.22116352 22.36216278,114.22115984 22.3621808,114.22115595 22.36220667,114.22115528 22.36221582,114.22115512 22.362225,114.22115581 22.36223874,114.22115604 22.36226157,114.22115758 22.36227985,114.2211588 22.36228895,114.2211697 22.3623449))");
	Math::CoordinateSystem *wgs84Csys = Math::CoordinateSystemManager::SRCreateCSys(4326);
	Math::CoordinateSystem *projCsys = Math::CoordinateSystemManager::SRCreateCSys(3857);
	Math::CoordinateSystem *hk80Csys = Math::CoordinateSystemManager::SRCreateCSys(2326);
	Math::WKTReader wktReader(4326);
	Math::Geometry::Polygon *pg = (Math::Geometry::Polygon*)wktReader.ParseWKT(pgWKT.v);
	Math::Coord2DDbl pt = Math::Coord2DDbl(114.22122894202,22.362089455590);
	Math::Coord2DDbl nearPt;
	pg->CalBoundarySqrDistance(pt, &nearPt);
	printf("Dist WGS84 (4326) = %lf\r\n", wgs84Csys->CalSurfaceDistanceXY(pt, nearPt, Math::Unit::Distance::DU_METER));

	Math::Coord2DDbl projPt;
	Double projZ;
	Math::Coord2DDbl projPt2;
	Double projZ2;
	Math::CoordinateSystem::ConvertXYZ(wgs84Csys, projCsys, pt.x, pt.y, 0, &projPt.x, &projPt.y, &projZ);
	Math::CoordinateSystem::ConvertXYZ(wgs84Csys, projCsys, nearPt.x, nearPt.y, 0, &projPt2.x, &projPt2.y, &projZ2);
	printf("Dist WGS84 proj (3857) = %lf\r\n", projCsys->CalSurfaceDistanceXY(projPt, projPt2, Math::Unit::Distance::DU_METER));

	Math::CoordinateSystem::ConvertXYZ(wgs84Csys, hk80Csys, pt.x, pt.y, 0, &projPt.x, &projPt.y, &projZ);
	Math::CoordinateSystem::ConvertXYZ(wgs84Csys, hk80Csys, nearPt.x, nearPt.y, 0, &projPt2.x, &projPt2.y, &projZ2);
	printf("Dist HK80 proj (2326) = %lf\r\n", hk80Csys->CalSurfaceDistanceXY(projPt, projPt2, Math::Unit::Distance::DU_METER));

	DEL_CLASS(pg);
	DEL_CLASS(projCsys);
	DEL_CLASS(wgs84Csys);
	DEL_CLASS(hk80Csys);
	return 0;
}